<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>A Deterministic Mapping for Plot Lifecycle Management &#183; Project Abundance</title><meta name=title content="A Deterministic Mapping for Plot Lifecycle Management &#183; Project Abundance"><meta name=description content="A new model for plot and sector lifecycle management and a draft spec in progress"><meta name=keywords content="status-update,consensus,"><link rel=canonical href=https://abundance.build/blog/2025-07-14-a-deterministic-mapping-for-plot-lifecycle-management/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fd951ea54edeca1b6b08c8bbf3c93c284de4c78daf63a71d8016939775734cf68700f1662ed31d870100c676cbe1f65d150635cf368b874c49fc75147bcb04a9.css integrity="sha512-/ZUepU7eyhtrCMi788k8KE3kx42vY6cdgBaTl3VzTPaHAPFmLtMdhwEAxnbL4fZdFQY1zzaLh0xJ/HUUe8sEqQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.e4b2d9aece2aa7a740c3ee7a0efc5acf56b204868ab0fb5bba9be32aed1cd0c9262979d98050759068d58144297f74b12ed05b5173cf2df2e6c097a066b984a8.js integrity="sha512-5LLZrs4qp6dAw+56Dvxaz1ayBIaKsPtbupvjKu0c0MkmKXnZgFB1kGjVgUQpf3SxLtBbUXPPLfLmwJegZrmEqA==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://abundance.build/blog/2025-07-14-a-deterministic-mapping-for-plot-lifecycle-management/"><meta property="og:site_name" content="Project Abundance"><meta property="og:title" content="A Deterministic Mapping for Plot Lifecycle Management"><meta property="og:description" content="A new model for plot and sector lifecycle management and a draft spec in progress"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-07-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-14T00:00:00+00:00"><meta property="article:tag" content="status-update"><meta property="article:tag" content="consensus"><meta name=twitter:card content="summary"><meta name=twitter:title content="A Deterministic Mapping for Plot Lifecycle Management"><meta name=twitter:description content="A new model for plot and sector lifecycle management and a draft spec in progress"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"A Deterministic Mapping for Plot Lifecycle Management","headline":"A Deterministic Mapping for Plot Lifecycle Management","description":"A new model for plot and sector lifecycle management and a draft spec in progress","abstract":"\u003cp\u003eThis week has been mainly focused on refining a bit the design for plot identification and sector\nexpiration. I think that I finally have a model with which I am comfortable with, and that I think\nsolves all of our previous problems. Nazar had this idea to drastically simplify how plot IDs were\nderived, and how sectors were linked to plots. The high-level idea made sense, but there were still\nsome details that weren\u0026rsquo;t clear. This week I managed to come up with a design that I think satisfies\nall of our requirements.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/abundance.build\/blog\/2025-07-14-a-deterministic-mapping-for-plot-lifecycle-management\/","author":{"@type":"Person","name":""},"copyrightYear":"2025","dateCreated":"2025-07-14T00:00:00\u002b00:00","datePublished":"2025-07-14T00:00:00\u002b00:00","dateModified":"2025-07-14T00:00:00\u002b00:00","keywords":["status-update","consensus"],"mainEntityOfPage":"true","wordCount":"1681"}]</script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link type=text/css rel=stylesheet href=/lib/katex/katex.min.7e7e35e3ef02b7b437449a44ca3fac62ec1ed39cb8312b680a00fe8ac60badc95b063b694636b8440856f7f5e8c2cc9e6b0efb581179b2656c7e1e97558c7096.css integrity="sha512-fn414+8Ct7Q3RJpEyj+sYuwe05y4MStoCgD+isYLrclbBjtpRja4RAhW9/Xowsyeaw77WBF5smVsfh6XVYxwlg=="><script defer type=text/javascript src=/js/katex.bundle.735b6f1542c0acf03d492dcdf14710c2e277474a64ae8ce49ef56563e17d142f9d3f4466e82cf12679968f50985628e08948ec341fba2df746545d0fd337d81d.js integrity="sha512-c1tvFULArPA9SS3N8UcQwuJ3R0pkrozknvVlY+F9FC+dP0Rm6CzxJnmWj1CYVijgiUjsNB+6LfdGVF0P0zfYHQ==" id=katex-render></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Project Abundance</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">A Deterministic Mapping for Plot Lifecycle Management</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-07-14T00:00:00+00:00>14 July 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">8 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/nazar-pc/abundance/tree/main/website/main/content/blog/2025/2025-07-14-scheduled-plot-lifecycle.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] mr-2" href=/tags/status-update/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">status-update
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/consensus/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">consensus</span></span></a></div></div><div class="flex author"><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex author author-extra mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/f1c66b8937bd6938a029cea2fdb21d9b_11706180554726321909_hu_1fd0f9097b9cc146.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://abundance.build/authors/adlrocha/ class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Alfonso de la Rocha</a><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/adlrocha target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/adlrocha target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/adlrocha target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:me@adlrocha.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>This week has been mainly focused on refining a bit the design for plot identification and sector
expiration. I think that I finally have a model with which I am comfortable with, and that I think
solves all of our previous problems. Nazar had this idea to drastically simplify how plot IDs were
derived, and how sectors were linked to plots. The high-level idea made sense, but there were still
some details that weren&rsquo;t clear. This week I managed to come up with a design that I think satisfies
all of our requirements.</p><p>Apart from all of this work around plot and sector lifecycle management, I also started working on a
draft specification for the protocol that fits all the pieces together. Our protocol builds upon the
Subspace protocol, so I am using the existing specification as a base and extending it with all the
sharding specifics. I can&rsquo;t wait to share the first draft with you all for feedback and suggestions.</p><h2 class="relative group">A Deterministic Mapping for Plot Lifecycle Management<div id=a-deterministic-mapping-for-plot-lifecycle-management class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#a-deterministic-mapping-for-plot-lifecycle-management aria-label=Anchor>#</a></span></h2><p>The core of this proposal is based on the simplification idea for sector expiration and plot
identification from this [zulip discussion]. The basic idea is to simplify plot identification by
removing scheduled, network-wide epochs. Instead, we introduce a <strong>deterministic, cyclical mapping
function</strong>. This approach decouples long-term shard assignment from the specific <code>history_size</code> by
mapping any <code>history_size</code> to a fixed set of &ldquo;history classes&rdquo;. This allows a farmer to continuously
update sectors with new history while having the flexibility to remain in the same shard, making a
<code>plot epoch</code> parameter unnecessary. This also limits the number of sectors that can be created in
parallel with the same sector index and different committed history sizes (artifically increasing
the storage of a plot).</p><p>The operation of the protocol is based on the concept of a <strong>History Modulo (<code>HISTORY_MODULO</code>)</strong>, a
new global protocol parameter that defines the total number of unique history classes. For example,
<code>HISTORY_MODULO</code> could be set to <code>2048</code>. This parameter governs the trade-off between farmer
flexibility and shard selection potential.</p><p>A farmer&rsquo;s assignment to a shard is determined not by the exact <code>history_size</code> they are plotting,
but by the class that history maps to.</p><ul><li><strong>History Class Calculation:</strong> When a farmer creates a sector, they commit to a
<code>committed_history_size</code>. From this, a <code>history_class</code> is derived using a simple modulo operation:<pre tabindex=0><code>history_class = committed_history_size % HISTORY_MODULO
</code></pre></li><li><strong>Plot ID Derivation:</strong> The stable <code>plot_id</code> is then created by hashing the farmer&rsquo;s public key
with this class. This is the crucial step that provides stability.<pre tabindex=0><code>plot_id = hash(public_key_hash, history_class)
</code></pre></li><li><strong>Shard Allocation:</strong> This <code>plot_id</code> is then used as the input to the Verifiable Random Function
(VRF) that determines the shard assignment.<pre tabindex=0><code>assigned_shard = vrf_output_to_shard(VRF(plot_id, randomness))
</code></pre></li></ul><p>Because <code>history_class</code> is the result of a modulo operation, many different <code>history_size</code> values
will map to the same class. This ensures the <code>plot_id</code> and the resulting shard assignment can remain
stable even as the farmer plots new history.</p><h4 class="relative group">Sector and Plot Identification<div id=sector-and-plot-identification class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#sector-and-plot-identification aria-label=Anchor>#</a></span></h4><p>Sectors must still be uniquely and verifiably tied to the specific history they contain.</p><ul><li><strong>Sector ID:</strong> The <code>sector_id</code> is derived simply from this <code>plot_id</code> and the sector&rsquo;s index within
the plot.<pre tabindex=0><code>sector_id = hash(plot_id, sector_index)
</code></pre></li></ul><p>This hierarchical ID structure ensures that a farmer&rsquo;s shard assignment can be stable, while still
enforcing that each sector is uniquely tied to its specific <code>committed_history_size</code> for
verification and expiration.</p><h3 class="relative group">Expiration and Re-Plotting Cadence<div id=expiration-and-re-plotting-cadence class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#expiration-and-re-plotting-cadence aria-label=Anchor>#</a></span></h3><p>This model creates a flexible and predictable lifecycle for farmers, giving them direct control over
their re-plotting strategy.</p><p><strong>Farmer Lifecycle Example:</strong></p><ol><li><p><strong>Joining:</strong> A farmer starts plotting when the current history size is <code>H_1</code>. They calculate
<code>history_class_1 = H_1 % HISTORY_MODULO</code>. This determines a <code>plot_id_1</code> and assigns them to a
corresponding shard. They begin filling their drive with sectors committed to <code>H_1</code>.</p></li><li><p><strong>Maintenance:</strong> As time passes and the chain grows to a history size of <code>H_2</code>, their initial
sectors from <code>H_1</code> begin to expire. The farmer uses the newly freed space to plot new sectors.
They now have a choice:</p></li></ol><ul><li><strong>Re-use Existing Plot:</strong> The farmer can choose to remain in the same plot (and thus the same
shard). To do this, they find a <code>committed_history_size</code> (<code>H_commit</code>) that is less than or equal
to <code>H_2</code> and also satisfies <code>H_commit % HISTORY_MODULO == history_class_1</code>. A farmer can easily
calculate the most recent history size that meets this criterion.</li><li><strong>Utilize a New Plot:</strong> Alternatively, the farmer can commit to the latest history, <code>H_2</code>. This
will generate a new class, <code>history_class_2 = H_2 % HISTORY_MODULO</code>, creating a new <code>plot_id</code> and
likely assigning them to a new shard.</li></ul><p>This model removes the concept of a mandatory, network-wide &ldquo;Epoch Turnover.&rdquo; Instead, re-shuffling
becomes a strategic choice made by the farmer.</p><h3 class="relative group">Benefits and Parameter Tuning<div id=benefits-and-parameter-tuning class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#benefits-and-parameter-tuning aria-label=Anchor>#</a></span></h3><p>This deterministic mapping provides significant advantages:</p><ul><li><strong>Simplicity:</strong> The logic is extremely straightforward, relying on a single new parameter
(<code>HISTORY_MODULO</code>) and simple modulo arithmetic.</li><li><strong>Farmer Quality of Life:</strong> Farmers are never forced into a disruptive, network-wide re-plotting
event. They have fine-grained control over which plots they maintain, reducing operational
overhead.</li><li><strong>Flexibility:</strong> Farmers can choose to commit to a slightly older history size to preserve their
shard assignment or switch to a new one if it is more advantageous.</li></ul><p>The primary consideration is tuning the <code>HISTORY_MODULO</code> parameter, which involves a direct
trade-off between farmer flexibility and preventing strategic shard selection.</p><h3 class="relative group">A model for parameter tuning<div id=a-model-for-parameter-tuning class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#a-model-for-parameter-tuning aria-label=Anchor>#</a></span></h3><p>The key to this design is selecting an optimal value for \(M\), the <code>HISTORY_MODULO</code>. This choice
involves balancing two competing factors: <strong>History Lag</strong> and <strong>Shard Selection Power</strong>.</p><p>Let&rsquo;s define the key parameters:</p><ul><li>\(M\): The <code>HISTORY_MODULO</code>, the number of distinct history classes. <strong>This is the value we want
to determine.</strong></li><li>\(S\): The total number of shards in the network.</li><li>\(H_{current}\): The current <code>history_size</code> of the blockchain.</li></ul><h4 class="relative group">Modeling Farmer Flexibility (History Lag)<div id=modeling-farmer-flexibility-history-lag class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#modeling-farmer-flexibility-history-lag aria-label=Anchor>#</a></span></h4><p>When a farmer wants to re-use an existing plot, they may not be able to use \(H_{current}\). This
creates a &ldquo;lag&rdquo; between their plotted history and the most current state of the network. We can
quantify this as the <strong>Average History Lag</strong> ((L_H)):</p><p>$$
L_H = \frac{M}{2}
$$</p><p>A larger \(M\) gives the farmer more classes to choose from, reducing the average lag for any given
class.</p><h4 class="relative group">Modeling Security (Shard Selection Power)<div id=modeling-security-shard-selection-power class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#modeling-security-shard-selection-power aria-label=Anchor>#</a></span></h4><p>A farmer could try to gain an advantage by choosing which history class to plot. With \(M\)
possible classes, they can generate \(M\) different <code>plot_id</code>s and calculate the resulting shard
for each, choosing the one that is most favorable. We can model this as the <strong>Shard Selection
Power</strong> (\(P_{select}\)), the probability of landing in one specific target shard:</p><p>$$
P_{select}(M, S) = 1 - \left(1 - \frac{1}{S}\right)^M
$$</p><p>A smaller \(M\) significantly reduces this probability, making it difficult for farmers to
strategically choose their shard.</p><h4 class="relative group">The Optimization Model<div id=the-optimization-model class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-optimization-model aria-label=Anchor>#</a></span></h4><p>The goal is to choose a value for \(M\) that provides a good balance. For example, if a network
has \(S=1000\) shards and we decide that no farmer should have more than a 5% chance of selecting
a specific shard, we would solve for \(M\):</p><p>$$
0.05 = 1 - \left(1 - \frac{1}{1000}\right)^M
$$</p><p>$$
\ln(0.95) = M \cdot \ln(0.999) \implies M \approx 51.3
$$</p><p>Based on this, a protocol designer might choose \(M=50\). This value would provide a low risk of
shard selection while ensuring the average history lag is only 25 segmentsâ€”a very reasonable
trade-off for farmer flexibility.</p><h3 class="relative group">An opportunity to simplify sector expiration?<div id=an-opportunity-to-simplify-sector-expiration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#an-opportunity-to-simplify-sector-expiration aria-label=Anchor>#</a></span></h3><p>Sector expiration has been the main thing messing with me when thinking about the design of this
part of the protocol. With this new approach to bind sectors into specific plots we may be able to
conceptually simplify the existing formula for sector expiration to make it more intuitive. The
logic is fundamentally sound.</p><p>Essentially, the current model can be thought of as:</p><p><strong><code>Expiration Point = Base Lifetime + Random Additional Lifetime</code></strong></p><p>Where:</p><ul><li><strong>Base Lifetime</strong> = <code>history_size + MIN_SECTOR_LIFETIME</code></li><li><strong>Random Additional Lifetime</strong> = A random value between 0 and <code>3 * history_size</code></li></ul><p>This conceptual model preserves all the benefits of the original design while being easier to reason
about. The current implementation, while verbose, appears to be a necessary complexity to ensure
long-term network health and fairness. What I want to do next is to figure out how to simplify this
conceptual model into a more intuitive formula that can be easily understood and reasoned about on
top of the current lifecycle management design. (<em>Worst case, we can keep the current sector
expiration, as it wouldn&rsquo;t break in any way with this new design.</em>)</p><h2 class="relative group">Spec in progress and next steps<div id=spec-in-progress-and-next-steps class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#spec-in-progress-and-next-steps aria-label=Anchor>#</a></span></h2><p>The <em>&ldquo;protocol overview&rdquo;</em> section of a specification is always the harder for me. I try to give a
high-level overview of the operation of the protocl that gives readers a core intuition of how all
the piece fit together. This way, one can have a clear mental model for when we jump into the
low-level details (where is easy to get lost into the weeds).</p><p>As mentioned above, this week I started working on the specification for the protocol, and I already
managed to have a protocol overview section that I am happy with. I hope to make more progress on it
in the coming days, and to figure a way to start sharing small pieces of it so I can start getting
feedback and improvement suggestions.</p><p>Throughout all of my more theoretical work from the past few weeks, I have been sharing theoretical
models for different parts of the protocol, but I haven&rsquo;t shared the specific protocol parameters
for the various components (e.g. the optimal <code>HISTORY_MODULO</code> value). As part of my spec&rsquo;ing
efforts, I am hoping to also recommend specific values for these parameters based on the theoretical
models and target system requirements. Hopefully, this will provide a more concrete foundation for
the protocol and help guide implementation efforts.</p><p>On another personal note, next week I will be giving a talk at the
<a href=https://web3summit.com/ target=_blank>Web3Summit in Berlin</a>, so if you are around and you want to chat about
this project, blockchain scalability, or honestly anything web3-related, feel free to reach out to
me. I will be around the event and would love to meet you in person.</p></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_blog/2025/2025-07-14-scheduled-plot-lifecycle.md data-oid-likes=likes_blog/2025/2025-07-14-scheduled-plot-lifecycle.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/blog/2025-07-13-what-is-blockchain-scalability/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">What is blockchain scalability?</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-07-13T00:00:00+00:00>13 July 2025</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/blog/2025-07-20-sparse-merkle-tree-and-client-database-preparation/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Sparse Merkle Tree and client database preparation</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-07-20T00:00:00+00:00>20 July 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0 z-10"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400"><a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel="license noopener noreferrer">CC0 1.0 Universal</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer></div></body></html>