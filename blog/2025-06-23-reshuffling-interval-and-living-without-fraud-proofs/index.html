<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Reshuffling interval and living without fraud proofs &#183; Project Abundance</title><meta name=title content="Reshuffling interval and living without fraud proofs &#183; Project Abundance"><meta name=description content="Can we implement a protocol that does not require fraud proofs?"><meta name=keywords content="status-update,consensus,"><link rel=canonical href=https://abundance.build/blog/2025-06-23-reshuffling-interval-and-living-without-fraud-proofs/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fd951ea54edeca1b6b08c8bbf3c93c284de4c78daf63a71d8016939775734cf68700f1662ed31d870100c676cbe1f65d150635cf368b874c49fc75147bcb04a9.css integrity="sha512-/ZUepU7eyhtrCMi788k8KE3kx42vY6cdgBaTl3VzTPaHAPFmLtMdhwEAxnbL4fZdFQY1zzaLh0xJ/HUUe8sEqQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.e4b2d9aece2aa7a740c3ee7a0efc5acf56b204868ab0fb5bba9be32aed1cd0c9262979d98050759068d58144297f74b12ed05b5173cf2df2e6c097a066b984a8.js integrity="sha512-5LLZrs4qp6dAw+56Dvxaz1ayBIaKsPtbupvjKu0c0MkmKXnZgFB1kGjVgUQpf3SxLtBbUXPPLfLmwJegZrmEqA==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://abundance.build/blog/2025-06-23-reshuffling-interval-and-living-without-fraud-proofs/"><meta property="og:site_name" content="Project Abundance"><meta property="og:title" content="Reshuffling interval and living without fraud proofs"><meta property="og:description" content="Can we implement a protocol that does not require fraud proofs?"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-06-23T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-23T00:00:00+00:00"><meta property="article:tag" content="status-update"><meta property="article:tag" content="consensus"><meta name=twitter:card content="summary"><meta name=twitter:title content="Reshuffling interval and living without fraud proofs"><meta name=twitter:description content="Can we implement a protocol that does not require fraud proofs?"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"Reshuffling interval and living without fraud proofs","headline":"Reshuffling interval and living without fraud proofs","description":"Can we implement a protocol that does not require fraud proofs?","abstract":"\u003cp\u003eLast week I shared a model that can help us reason about the security of shards assuming an honest\nmajority in the beacon chain. The model evaluates what are the trade-offs in terms of the number of\nshards, the number of farmers per shard, and the proportion of malicious farmers in the system. But\nif you recall from the overall design of the system, shards are periodically submitting segments and\nblocks to the upper layers of the hierarchy and to the beacon chain. We need to verify that these\nare valid, available, and correctly encoded before they are included in super segments and the\nglobal history of the system. Can we do so without relying on fraud proofs? This has been one of my\nfocuses for the week, let\u0026rsquo;s jump right into it.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/abundance.build\/blog\/2025-06-23-reshuffling-interval-and-living-without-fraud-proofs\/","author":{"@type":"Person","name":""},"copyrightYear":"2025","dateCreated":"2025-06-23T00:00:00\u002b00:00","datePublished":"2025-06-23T00:00:00\u002b00:00","dateModified":"2025-06-23T00:00:00\u002b00:00","keywords":["status-update","consensus"],"mainEntityOfPage":"true","wordCount":"2372"}]</script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link type=text/css rel=stylesheet href=/lib/katex/katex.min.7e7e35e3ef02b7b437449a44ca3fac62ec1ed39cb8312b680a00fe8ac60badc95b063b694636b8440856f7f5e8c2cc9e6b0efb581179b2656c7e1e97558c7096.css integrity="sha512-fn414+8Ct7Q3RJpEyj+sYuwe05y4MStoCgD+isYLrclbBjtpRja4RAhW9/Xowsyeaw77WBF5smVsfh6XVYxwlg=="><script defer type=text/javascript src=/js/katex.bundle.735b6f1542c0acf03d492dcdf14710c2e277474a64ae8ce49ef56563e17d142f9d3f4466e82cf12679968f50985628e08948ec341fba2df746545d0fd337d81d.js integrity="sha512-c1tvFULArPA9SS3N8UcQwuJ3R0pkrozknvVlY+F9FC+dP0Rm6CzxJnmWj1CYVijgiUjsNB+6LfdGVF0P0zfYHQ==" id=katex-render></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Project Abundance</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Reshuffling interval and living without fraud proofs</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-06-23T00:00:00+00:00>23 June 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">12 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/nazar-pc/abundance/tree/main/website/main/content/blog/2025-06-23-reshuffling-interval-and-fraud-proofs.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] mr-2" href=/tags/status-update/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">status-update
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/consensus/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">consensus</span></span></a></div></div><div class="flex author"><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex author author-extra mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/f1c66b8937bd6938a029cea2fdb21d9b_11706180554726321909_hu_1fd0f9097b9cc146.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://abundance.build/authors/adlrocha/ class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Alfonso de la Rocha</a><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/adlrocha target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/adlrocha target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/adlrocha target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:me@adlrocha.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>Last week I shared a model that can help us reason about the security of shards assuming an honest
majority in the beacon chain. The model evaluates what are the trade-offs in terms of the number of
shards, the number of farmers per shard, and the proportion of malicious farmers in the system. But
if you recall from the overall design of the system, shards are periodically submitting segments and
blocks to the upper layers of the hierarchy and to the beacon chain. We need to verify that these
are valid, available, and correctly encoded before they are included in super segments and the
global history of the system. Can we do so without relying on fraud proofs? This has been one of my
focuses for the week, let&rsquo;s jump right into it.</p><h2 class="relative group">Farmer reshuffling to prevent fraud proofs<div id=farmer-reshuffling-to-prevent-fraud-proofs class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#farmer-reshuffling-to-prevent-fraud-proofs aria-label=Anchor>#</a></span></h2><p>Let me refresh your memories by describing how we are planning to work around requiring fraud
proofs. The core idea here is that by leveraging the reshuffling of farmers (or actually plots)
across the different shards, and the fact that when farmers are assigned to a new shard they need to
sync and verify the latest history of that shard, we can ensure that any fraudulent segment will be
detected by honest farmers.</p><ul><li>If a malicious farmer in a shard creates an invalid block or segment (invalid transaction, state
transition, incorrect encoding, etc.), <em>eventually</em> an honest farmer will be assigned to that
shard during a reshuffle. This honest farmer will download and verify the latest shard&rsquo;s history.
Upon encountering the invalid block or segment, they will trigger a re-org that will be detected
in follow-up submissions by the parent and the beacon chain. Intermediate shards and the beacon
chain do not immediately accept new blocks being submitted by child shards, they wait for one or
more reshuffling intervals to ensure that the data has been verified by honest farmers. In the
next section I will share the model to determine the optimal values depending on the desired
security level.</li><li>When the honest farmer detects fraud, they will refuse to build on top of the fraudulent chain. If
the shard has a sufficient number of honest farmers that detect this, they will collectively build
a valid fork, effectively causing a re-org that prunes the fraudulent history.</li><li>This mechanism also addresses data availability directly. If a block or a segment is unavailable,
the syncing farmer cannot download it and thus cannot reconstruct the state. This inability to
sync would trigger the same &ldquo;re-org&rdquo; or &ldquo;rejection&rdquo; behavior, preventing the malicious chain from
progressing as new farmers will only be able to grow the chain from the latest valid state. The
missing block or segment would have to be re-created. The assumption is that if data is not
available, it effectively means the chain cannot be validly extended by honest participants and
the chain needs to be recovered from the last known state.</li></ul><p>Skimming through the literature around sharded blockchains and fraud proofs uncovered that this
approach is often referred to as &ldquo;<em>periodic reshuffling with full-state downloads&rdquo;</em> or
<em>state-sync-based fraud detection</em> in other protocols. This looks promising, but we need to model it
to understand the implications in terms of security and the trade-offs involved (especially
regarding the reshuffling interval).</p><h2 class="relative group">Modeling the Reshuffling Interval (R)<div id=modeling-the-reshuffling-interval-r class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#modeling-the-reshuffling-interval-r aria-label=Anchor>#</a></span></h2><p>Let&rsquo;s define some parameters and then formalise the security of the mechanism.</p><h3 class="relative group">Key Parameters:<div id=key-parameters class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#key-parameters aria-label=Anchor>#</a></span></h3><ul><li>\(N\): Total number of farmers (or plots) in the system.</li><li>\(S\): Total number of shards.</li><li>\(n=N/S\): Average number of farmers per shard.</li><li>\(p\): Proportion of malicious farmers in the entire system.</li><li>\(f\): Minimum proportion of honest farmers required within a shard to detect and force a
re-org. This is typically \(>0.5\) (e.g., \(f=0.51\)) to outvote or out-compute the malicious
actors.</li><li>\(T_B\): Average block time of the beacon chain.</li><li>\(T_S\): Average block time of a shard.</li><li>\(L\): Number of blocks in a reshuffling interval (i.e., reshuffling happens every \(L\)
blocks on the beacon chain).</li><li>\(R=L \cdot T_B\): Duration of a reshuffling interval in real time.</li><li>\(\alpha_{fraud}\): Acceptable probability that a fraudulent segment remains undetected after
a certain number of reshuffles. This is your desired &ldquo;security level&rdquo; against undetected fraud.</li></ul><h2 class="relative group">Modeling the Detection Probability:<div id=modeling-the-detection-probability class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#modeling-the-detection-probability aria-label=Anchor>#</a></span></h2><h3 class="relative group">Probability of a Malicious Shard:<div id=probability-of-a-malicious-shard class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#probability-of-a-malicious-shard aria-label=Anchor>#</a></span></h3><p>Using the Chernoff bound from my previous update, the probability that a specific shard has \( \ge
f \cdot n \) malicious farmers is:</p><p>$$
P(\text{Shard } k \text{ is insecure}) = P(M_k/n_k \ge f)
\le e^{-n(f-p)^2/(3p)}
$$</p><p>(assuming \(f>p\)).</p><p>Let this be \(P_{\text{insecure_shard}}\). This is the probability that a shard is immediately
vulnerable upon formation.</p><h3 class="relative group">Probability of an Honest Farmer Being Assigned to a Shard:<div id=probability-of-an-honest-farmer-being-assigned-to-a-shard class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#probability-of-an-honest-farmer-being-assigned-to-a-shard aria-label=Anchor>#</a></span></h3><p>In each reshuffling interval, a farmer is randomly assigned to a shard. The probability that a
specific honest farmer is assigned to a specific shard is \(1/S\).</p><p>More generally, the probability that a newly assigned farmer to a shard is honest is \(1-p\).</p><h3 class="relative group">Probability of Detecting Fraud in One Interval:<div id=probability-of-detecting-fraud-in-one-interval class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#probability-of-detecting-fraud-in-one-interval aria-label=Anchor>#</a></span></h3><p>Consider a shard where fraud has occurred. We need an honest farmer to be assigned to this shard.</p><p>Let \(k\) be the number of farmers assigned to a shard during one reshuffling. For simplicity,
let&rsquo;s assume \(k \approx n\) (the average).</p><p>The probability that at least one of the \(n\) newly assigned farmers to a specific shard is
honest is:
$$P(\text{at least one honest farmer in new assignment}) = 1 - P(\text{all new assignments are malicious})$$
$$P(\text{at least one honest in new assignment}) = 1 - p^n$$</p><p>This is an oversimplification, as it assumes all \(n\) farmers are new. In reality, farmers are
shuffled amongst existing shards, and some farmers might remain in the same shard, or might be
replaced by other farmers. A more accurate model considers that a random subset of \(n\) farmers
are drawn from the \(N\) total farmers and assigned to this specific shard, but our case is closer
to the scenario where all farmers are new.</p><p>Let&rsquo;s refine: For a specific shard that has committed fraud, what&rsquo;s the probability that none of the
\(n\) farmers assigned to it in the next reshuffling interval are honest? This is \(p^n\) if
assignments are done with replacement from the global pool (which is a reasonable approximation for
large \(N\)).</p><p>So, \(P(\text{fraud detected by new assignment in 1 interval}) = 1 - p^n\).</p><p>This assumes that if an honest farmer is assigned, they will detect the fraud and initiate a re-org.</p><h3 class="relative group">Probability of Fraud Remaining Undetected After k Reshuffles:<div id=probability-of-fraud-remaining-undetected-after-k-reshuffles class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#probability-of-fraud-remaining-undetected-after-k-reshuffles aria-label=Anchor>#</a></span></h3><p>If a fraudulent segment or a block is submitted to the upper layers of the hierarchy, it potentially
remains undetected until an honest farmer is assigned to that shard and syncs.</p><p>The probability that fraud in a specific shard remains undetected for \(k\) consecutive reshuffles
is \( (p^n)^k \).</p><p>So, \( P(\text{fraud detected by interval } k) = 1 - (p^n)^k \).</p><h3 class="relative group">Overall Security Bound (\(\alpha_{fraud}\)):<div id=overall-security-bound-alpha_fraud class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#overall-security-bound-alpha_fraud aria-label=Anchor>#</a></span></h3><p>We want the probability that any fraudulent segment or block remains undetected for \(k\)
intervals to be very low. \( P(\text{any fraud undetected for } k \text{ intervals}) \le S \cdot
(p^n)^k \) (Union Bound over shards)</p><p>Setting this to \( \alpha*{fraud} \): \( S \cdot (p^n)^k &lt; \alpha*{fraud} \)</p><p>This equation allows us to reason about the trade-offs (that actually match the intuition we had):</p><ul><li>Increasing \(k\) (more reshuffles): Decreases the probability of undetected fraud, but increases
the time a segment might be considered &ldquo;tentatively final&rdquo; before true probabilistic finality.</li><li>Decreasing \(p\) (fewer malicious farmers): Drastically reduces the probability, but implies a
stronger honest majority assumption.</li><li>Increasing \(n\) (fewer shards/more farmers per shard): Drastically reduces the probability, but
impacts scalability.</li><li>Decreasing \(S\) (fewer shards): Reduces the number of opportunities for fraud across the
system.</li></ul><h3 class="relative group">Solving for \(k\) (number of reshuffles until detection):<div id=solving-for-k-number-of-reshuffles-until-detection class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#solving-for-k-number-of-reshuffles-until-detection aria-label=Anchor>#</a></span></h3><p>Given \(S, p, n, \alpha*{fraud}\): \( k > \frac{\log(\alpha*{fraud}/S)}{\log(p^n)} \)</p><p>This \(k\) gives use the number of reshuffling intervals we might need to &ldquo;wait&rdquo; before a block or
a segment can be considered probabilistically secure against undetected fraud. If a block or segment
submitted to the beacon chain and eventually included in a SuperSegment at beacon height \(H\),
and \(k\) reshuffles happen, the &ldquo;true&rdquo; finality could be argued to be at beacon height \( H+k
\cdot L \).</p><p>With this, we can determine the optimal reshuffling interval based on the desired security level
(\(\alpha_{fraud}\)) and the parameters of the system.</p><h2 class="relative group">Farming in shards<div id=farming-in-shards class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#farming-in-shards aria-label=Anchor>#</a></span></h2><p>Another piece of the puzzle that I left behind from my previous update is how farmers are chosen to
propose the next block in the shard they&rsquo;ve been allocated to, and how can this allocation be
verified by the rest of the network. Last week, we introduced the concept of a <em>PlotID</em> used to
uniquely identify a plot (i.e. a batch of storage sectors), and used to determine the allocation of
storage in the system.</p><p>Farming in shards work in the same way as it currently works in the Subspace protocol, with the main
difference that now the winning farmer will have to also present along with the block a proof that
one of its plots belongs to the shard and hence is entitled to propose a new block in that shard.</p><p>If we look at the data structure from below, we can see that by including the <code>plot_id</code> that
determines the allocation of a farmer&rsquo;s storage to the shard and some additional information, we can
determine if the farmer is entitle to propose a block in the shard.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// -- The shard ID is explicitly shared in the block header.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Solution</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>public_key_hash</span>:     <span class=mi>32</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sector_index</span>:         <span class=mi>2</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>history_size</span>:         <span class=mi>8</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>piece_offset</span>:         <span class=mi>2</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>record_commitment</span>:   <span class=mi>48</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>record_witness</span>:      <span class=mi>48</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>chunk</span>:               <span class=mi>32</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>chunk_witness</span>:       <span class=mi>48</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>proof_of_space</span>:     <span class=mi>160</span><span class=w> </span><span class=n>bytes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// --- NEW FIELD FOR MEMBERSHIP AND PLOT UNIQUENESS PROOF ---
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>// Unique identifier for the plot or the pieces of information required to infer it within the block
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>// (e.g. public key, max plot size, min and max history size).
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>plot_id</span>:             <span class=mi>32</span><span class=w> </span><span class=n>bytes</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Additional information that we may need to include as part of the `Solution` struct
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>// if we make the configurable instead of protocol parameters (we can keep them out of the struct
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>// but consider them available for verification for the sake of this discussion.)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>max_plot_size</span>:       <span class=mi>64</span><span class=w> </span><span class=n>bytes</span><span class=p>,</span><span class=w> </span><span class=c1>// Maximum size of the plot.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// These two parameters may be simplified into a single one depending on how we end up implementing re-plotting and
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>// the expiration of sectors as it will be described below.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>min_history_size</span>:    <span class=mi>8</span><span class=w> </span><span class=n>bytes</span><span class=p>,</span><span class=w> </span><span class=c1>// Minimum history size the sectors in the plot are allowed to commit to.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>max_history_size</span>:    <span class=mi>8</span><span class=w> </span><span class=n>bytes</span><span class=p>,</span><span class=w> </span><span class=c1>// Maximum history size the sectors in the plot are allowed to commit to.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// This parameters determines that randomness used in the last reshuffling interval to determine the membership allocation,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>// and will be required to determine that the proposing farmer is currently allocated to the shard.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>membership_allocation_randomness_seed</span><span class=w>
</span></span></span></code></pre></div><p>At a really high-level these are the steps required to verify that a block includes the right
solution, and that the farmer plot is allocated to the shard:</p><ul><li><p><strong>Standard Subspace PoAS Verification</strong>: It works in the same as it currently works in Subspace.</p><ul><li>Verify <code>public_key</code> is not in block list.</li><li>Verify consensus log (<code>solution_range</code>, <code>global_randomness</code>).</li><li>Verify PoT items.</li><li>Compute <code>global_challenge = hash(global_randomness || slot_number)</code>.</li><li>Verify <code>current_chain_history_size > winning_piece_index / NUM_PIECES</code>. (This is key for
<code>history_size</code> validity).</li><li>Verify <code>piece_offset &lt;= max_pieces_in_sector</code>.</li><li>Derive <code>public_key_hash = hash(public_key)</code> (already in current process).</li><li>Re-derive the <code>sector_id</code></li></ul></li><li><p><strong>Verify Implicit <code>plot_id</code> Consistency and Uniqueness Constraints:</strong></p><ul><li>Re-derive <code>declared_plot_id</code>:
<code>declared_plot_id = keyed_hash(solution.public_key_hash, solution.max_plot_size || solution.min_history_size || solution.max_history_size)</code>
(Note: <code>public_key_hash</code> is computed from <code>block.public_key</code>).</li><li>Verify <code>history_size</code> falls within plot&rsquo;s declared window: Check that
<code>solution.history_size >= solution.min_history_size</code> AND
<code>solution.history_size &lt;= solution.max_history_size</code>. <em>This is the core check preventing
&ldquo;double-committing sectors&rdquo; to different history sizes for allocation bias.</em> If a farmer tries
to submit a <code>sector_id</code> that uses a <code>history_size</code> outside the <em>declared</em>
<code>[min_history_size, max_history_size]</code> window for that <code>plot_id</code>, the block is invalid.</li><li>Derive <code>constrained_sector_id</code>:
<code>constrained_sector_id = keyed_hash(declared_plot_id, solution.sector_index || solution.history_size)</code>
<em>This is the critical new <code>sector_id</code> that incorporates the plot&rsquo;s history window constraint.</em></li><li>Now, use <code>constrained_sector_id</code> for all subsequent verification steps that currently use the
<code>public_key_hash</code> derived <code>sector_id</code>:<ul><li>Replace <code>sector_id</code> in <code>sector_expiration_check_history_size</code>, <code>expiration_history_size</code>,
<code>sector_slot_challenge</code>, <code>s_bucket_audit_index</code>, <code>evaluation_seed</code> with
<code>constrained_sector_id</code>.</li><li>This means the farmer&rsquo;s proof must ultimately derive from a <code>sector_id</code> that respects the
<code>plot_id</code>&rsquo;s declared history boundaries.</li></ul></li></ul></li><li><p><strong>Verify Shard Assignment (incorporating <code>plot_id</code>):</strong></p><ul><li>Retrieve the <code>randomness_seed</code> from the beacon chain state root at
<code>solution.shard_assignment_seed_beacon_height</code> and
<code>solution.shard_assignment_seed_beacon_block_hash</code>. (This assumes the verifier has access to
canonical beacon chain history).</li><li>Compute <code>expected_shard_id = VRF_verify(randomness_seed || declared_plot_id) % S</code>.</li><li>Check that <code>expected_shard_id == ShardBlock.header.shard_id</code>. This proves the farmer was
legitimately assigned to propose for this shard based on their <em>declared plot</em>.</li></ul></li><li><p><strong>Complete Existing Subspace PoSt Verification (using <code>constrained_sector_id</code>):</strong></p><ul><li>Verify <code>sector_id</code> expiration (now using <code>constrained_sector_id</code>).</li><li>Re-derive <code>sector_slot_challenge = global_challenge XOR constrained_sector_id</code>.</li><li>Re-derive <code>s_bucket_audit_index = sector_slot_challenge mod NUM_S_BUCKETS</code>.</li><li>Re-derive <code>evaluation_seed = hash(constrained_sector_id || piece_offset)</code>.</li><li>Verify <code>proof_of_space</code>.</li><li>Ensure <code>chunk</code> satisfies challenge criteria (using <code>sector_slot_challenge</code> from
<code>constrained_sector_id</code>).</li><li>Verify <code>chunk_witness</code>.</li><li>Re-derive <code>piece_index</code> (this uses <code>history_size</code>, which is checked against plot bounds).</li><li>Retrieve <code>segment_commitment</code> (needs to match <code>history_size</code>).</li><li>Verify <code>record_witness</code>.</li><li>Verify <code>farmer_signature</code> on <code>chunk</code>.</li><li>Verify signature on block content.</li><li>Check for equivocation.</li></ul></li></ul><h2 class="relative group">What&rsquo;s next?<div id=whats-next class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#whats-next aria-label=Anchor>#</a></span></h2><p>The farming protocol presented above assumed a really specific mechanism for sector expiration and
re-plotting. Unfortunately, after discussing it with Nazar we realised that my re-plotting proposal
had some holes, so while the high-level of the verification stands, expect some minor changes in the
information included in the header and the verification process. This will mainly be related with
the history size window of the plot. I don&rsquo;t expect any big refactor to be needed here, but stay
tuned!</p><p>With this in mind, my two main focus for this week are on:</p><ul><li>Detailing the protocol for sector expiration in plots while maintaining the commitment of plots to
a specific history size through their plot ID.</li><li>Updating the python script that I wrote a few weeks ago that allows us to model and tweak the
parameters of the protocol with the new model of the past two weeks merging all together to try to
surface the optimal protocol parameters and what that entails to the security of the system.</li></ul><p>And that&rsquo;s all for this week, looking forward to share my progress next week (hopefully with a big
batch of good results).</p></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_blog/2025-06-23-reshuffling-interval-and-fraud-proofs.md data-oid-likes=likes_blog/2025-06-23-reshuffling-interval-and-fraud-proofs.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/blog/2025-06-16-beacon-chain-block-processing-infrastructure/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Beacon chain block processing infrastructure</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-06-16T00:00:00+00:00>16 June 2025</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/blog/2025-06-23-block-processing-progress/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Block processing progress</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-06-23T00:00:00+00:00>23 June 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0 z-10"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400"><a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel="license noopener noreferrer">CC0 1.0 Universal</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer></div></body></html>