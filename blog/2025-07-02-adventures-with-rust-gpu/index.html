<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Adventures with rust-gpu &#183; Project Abundance</title><meta name=title content="Adventures with rust-gpu &#183; Project Abundance"><meta name=description content="An incomplete attempt to reimplement GPU plotting using rust-gpu"><meta name=keywords content="status-update,"><link rel=canonical href=https://abundance.build/blog/2025-07-02-adventures-with-rust-gpu/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fd951ea54edeca1b6b08c8bbf3c93c284de4c78daf63a71d8016939775734cf68700f1662ed31d870100c676cbe1f65d150635cf368b874c49fc75147bcb04a9.css integrity="sha512-/ZUepU7eyhtrCMi788k8KE3kx42vY6cdgBaTl3VzTPaHAPFmLtMdhwEAxnbL4fZdFQY1zzaLh0xJ/HUUe8sEqQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.e4b2d9aece2aa7a740c3ee7a0efc5acf56b204868ab0fb5bba9be32aed1cd0c9262979d98050759068d58144297f74b12ed05b5173cf2df2e6c097a066b984a8.js integrity="sha512-5LLZrs4qp6dAw+56Dvxaz1ayBIaKsPtbupvjKu0c0MkmKXnZgFB1kGjVgUQpf3SxLtBbUXPPLfLmwJegZrmEqA==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://abundance.build/blog/2025-07-02-adventures-with-rust-gpu/"><meta property="og:site_name" content="Project Abundance"><meta property="og:title" content="Adventures with rust-gpu"><meta property="og:description" content="An incomplete attempt to reimplement GPU plotting using rust-gpu"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-07-02T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-02T00:00:00+00:00"><meta property="article:tag" content="status-update"><meta name=twitter:card content="summary"><meta name=twitter:title content="Adventures with rust-gpu"><meta name=twitter:description content="An incomplete attempt to reimplement GPU plotting using rust-gpu"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"Adventures with rust-gpu","headline":"Adventures with rust-gpu","description":"An incomplete attempt to reimplement GPU plotting using rust-gpu","abstract":"\u003cp\u003eGPU plotting was one of the items on the roadmap last week and that turned into a week\u002b long side quest, so let me share\nsome details about that.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/abundance.build\/blog\/2025-07-02-adventures-with-rust-gpu\/","author":{"@type":"Person","name":""},"copyrightYear":"2025","dateCreated":"2025-07-02T00:00:00\u002b00:00","datePublished":"2025-07-02T00:00:00\u002b00:00","dateModified":"2025-07-02T00:00:00\u002b00:00","keywords":["status-update"],"mainEntityOfPage":"true","wordCount":"1335"}]</script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Project Abundance</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Adventures with rust-gpu</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-07-02T00:00:00+00:00>2 July 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/nazar-pc/abundance/tree/main/website/main/content/blog/2025-07-02-adventures-with-rust-gpu.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] mr-2" href=/tags/status-update/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">status-update</span></span></a></div></div><div class="flex author"><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex author author-extra mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/3d67cc976284fd62356e2edd8a8dfc49_2651210052118205119_hu_2fd6f6eca7f7083d.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://abundance.build/authors/nazar-pc/ class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Nazar Mokrynskyi</a><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/nazarpc target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/nazarpc target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/nazar-pc target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:nazar@mokrynskyi.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>GPU plotting was one of the items on the roadmap last week and that turned into a week+ long side quest, so let me share
some details about that.</p><h2 class="relative group">Background<div id=background class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#background aria-label=Anchor>#</a></span></h2><p>For a little bit of background, <a href=https://subspace.github.io/protocol-specs/docs/protocol_specifications target=_blank>Subspace protocol</a> has a compute-intensive plotting component, where the majority of
the cost is Chia-based <a href=https://subspace.github.io/protocol-specs/docs/consensus/proof_of_space target=_blank>Proof-of-Space</a> that is used to encode plots (it is used differently than in Chia, but that is
not very important here).</p><p>This is something that can be accelerated with GPU and, in fact, is extremely desirable to make plotting more energy
efficient and less time-consuming. In Subspace GPU plotting was implemented for CUDA/ROCm by very skilled folks from
<a href=https://www.supranational.net/ target=_blank>Supranational</a>. Unfortunately, it broke after switching from KZG and some other changes, which left it in unusable
state.</p><p>Now I&rsquo;m trying to avoid C++ when I can, let alone CUDA C++, so I was looking for ways to rewrite it in Rust instead if
possible, which I shared in the past updates. On top of that, previous implementation was picky on AMD side, it only
really worked with RX 6000/7000 GPUs (on the consumer side) and only on Linux. <a href=https://github.com/ROCm/HIP/issues/3640 target=_blank>According to AMD developers</a> it is
unlikely that Windows support will come any time soon, there were also annoyances caused by
<a href=https://github.com/ROCm/ROCR-Runtime/issues/240 target=_blank>dynamic linking required by ROCm</a> to a specific release of their libraries.</p><p>And forget about Intel or Apple, iGPUs, etc.</p><p>So as you can imagine, I wasn&rsquo;t particularly thrilled with the status quo to begin with. The better situation would be
to target Vulkan/Metal, which is exactly what <a href=https://github.com/gfx-rs/wgpu target=_blank>wgpu</a> allows, but we need shaders and I want them in Rust, not yet
another obscure language to suffer with.</p><h2 class="relative group">CubeCL<div id=cubecl class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#cubecl aria-label=Anchor>#</a></span></h2><p>I looked at CubeCL a few times, tried to write some kernels, but in the end I gave up on it, for now at least. The basic
issue I have with it is that it is one of those obscure shader languages. Yes, it looks like Rust, but it only supports
a subset of language features and standard library, doesn&rsquo;t allow to freely pull <code>no_std</code> crates from crates.io and as
the result ends up not being a real Rust.</p><p>I strongly considered this path, but ultimately I do want to be able to use Rust with any of its features and have the
fullest control over the compilation output of the code.</p><h2 class="relative group">rust-gpu<div id=rust-gpu class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#rust-gpu aria-label=Anchor>#</a></span></h2><p>This brings be back to <a href=https://github.com/Rust-GPU/rust-gpu target=_blank>rust-gpu</a>, which I initially dismissed due to it requiring old nightly compiler, but
with <a href=https://github.com/Rust-GPU/cargo-gpu target=_blank>cargo-gpu</a> as a library it became not great, but at least usable. It is in fact actual Rust, more specifically a
codegen backend that rustc calls to produce regular SPIR-V binary, which can be executed on a GPU using wgpu or other
libraries. Using wgpu for this purpose is nice because it&rsquo;ll recompile SPIR-V, which is Vulkan-specific, into shader
that runs on Apple&rsquo;s Metal API, which means support for quite powerful Apple Silicon iGPUs.</p><p>With that, I started prototyping and learned a lot in progress about rust-gpu, Vulkan, SPIR-V and GPU programming in
general. One interesting property that surfaced fairly quickly was that GPUs really like 32-bit integers and seriously
dislike smaller and larger ones, something like <code>u128</code> is not generally available at all, even as an optional
capability.</p><p>Not going to lie, it was a struggle. There are countless limitations in rust-gpu as it stands today, and eventually I
hit a wall that I&rsquo;ll probably stop at for now. But I have made progress. When you look at <a href=https://subspace.github.io/protocol-specs/docs/consensus/proof_of_space target=_blank>Proof-of-Space spec</a>, I have
ChaCha8 keystream derivation and <code>compute_f1()</code> fully implemented as shaders, and even tested with <a href=https://docs.mesa3d.org/drivers/llvmpipe.html target=_blank>LLVMpipe</a> in CI.
<code>compute_fn()</code> is technically implemented, but unfortunately doesn&rsquo;t quite compile despite my best efforts to work
around every last limitation. Since <code>u64</code> is not supported on all GPUs and <code>u128</code> is not supported anywhere (at least
until rust-gpu learns <a href=https://github.com/Rust-GPU/rust-gpu/issues/307 target=_blank>to add polyfills</a> for them), I had to write polyfills for both and test them against native
types, ensuring they have the same exact binary representation in memory.</p><p>That still leaves matching logic and sorting. For sorting, there are some libraries on crates.io, hopefully something
that will work and for matching it shouldn&rsquo;t be terribly difficult to implement directly. CUDA C++ implementation also
did erasure coding, but I didn&rsquo;t look into how difficult it&rsquo;ll be to make <a href=https://github.com/AndersTrier/reed-solomon-simd target=_blank>reed-solomon-simd</a> work with rust-gpu yet.
Worst case we&rsquo;ll do it on CPU for now, erasure coding is A LOT faster now than it was with KZG stuff involved.</p><p>If you&rsquo;re interested in what I have so far, <a href=https://github.com/nazar-pc/abundance/pull/313 target=_blank>PR 313</a> was the very first piece of code with GPU with a few follow-ups
in <a href=https://github.com/nazar-pc/abundance/pull/314 target=_blank>PR 314</a>, <a href=https://github.com/nazar-pc/abundance/pull/315 target=_blank>PR 315</a> and <a href=https://github.com/nazar-pc/abundance/pull/320 target=_blank>PR 320</a>.</p><h2 class="relative group">Other work<div id=other-work class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#other-work aria-label=Anchor>#</a></span></h2><p>Learning more about GPUs makes one re-think some of the existing approaches. As I mentioned earlier, GPUs really do not
like working with individual bytes, but strongly prefer <code>u32</code>, so as I was writing GPU code I though if CPU can benefit
from similar changes, which led to <a href=https://github.com/nazar-pc/abundance/pull/312 target=_blank>PR 312</a> with substantial PoSpace verification performance improvement:</p><pre tabindex=0><code>Before:
chia/verification       time:   [9.3419 µs 9.4671 µs 9.7223 µs]
After:
chia/verification       time:   [7.4406 µs 7.4539 µs 7.4651 µs]
</code></pre><p>I was also increasingly frustrated with how difficult it is to land any changes to upstream <a href=https://github.com/BLAKE3-team/BLAKE3 target=_blank>BLAKE3</a> crate and since I
needed BLAKE3 for GPU plotting as well, I ended up creating <code>ab-blake3</code> crate. It currently has more exotic and
special-purpose APIs. For example there are <code>const fn</code> methods that were under review upstream <a href=https://github.com/BLAKE3-team/BLAKE3/pull/439 target=_blank>since January</a>, there
are also more compact (and thus easier for compiler to optimize) methods that handle up to one chunk and up to one block
worth of data only. For single block version, I also created a portable variant that works with <code>u32</code> words instead of
individual bytes, which as you may have guessed is necessary for GPU. In the future there I&rsquo;d like to have single-block
variants that can process <a href=https://github.com/BLAKE3-team/BLAKE3/issues/478 target=_blank>multiple independent blocks with SIMD</a>.</p><p>Initial implementation landed in <a href=https://github.com/nazar-pc/abundance/pull/316 target=_blank>PR 316</a> with further extension in <a href=https://github.com/nazar-pc/abundance/pull/318 target=_blank>PR 318</a>. Using it in the repo immediately yielded
further small performance improvements:</p><pre tabindex=0><code>Merkle Tree before:
65536/balanced/new      time:   [4.1899 ms 4.1903 ms 4.1919 ms]
65536/balanced/compute-root-only
                        time:   [4.2740 ms 4.2743 ms 4.2754 ms]
65536/balanced/all-proofs
                        time:   [1.4789 ns 1.4796 ns 1.4824 ns]
65536/balanced/verify   time:   [70.688 ms 70.696 ms 70.728 ms]

Merkle Tree after:
65536/balanced/new      time:   [3.8788 ms 3.8789 ms 3.8790 ms]
65536/balanced/compute-root-only
                        time:   [3.6719 ms 3.6851 ms 3.6884 ms]
65536/balanced/all-proofs
                        time:   [1.4212 ns 1.4222 ns 1.4225 ns]
65536/balanced/verify   time:   [65.727 ms 65.792 ms 66.050 ms]

PoSpace before:
chia/table/single       time:   [1.0683 s 1.0908 s 1.1156 s]
chia/table/parallel/1x  time:   [158.26 ms 160.78 ms 163.98 ms]
chia/table/parallel/8x  time:   [860.76 ms 873.21 ms 885.64 ms]
chia/verification       time:   [7.4406 µs 7.4539 µs 7.4651 µs]

PoSpace after:
chia/table/single       time:   [977.21 ms 985.74 ms 996.67 ms]
chia/table/parallel/1x  time:   [160.87 ms 162.47 ms 163.84 ms]
chia/table/parallel/8x  time:   [821.04 ms 833.45 ms 850.07 ms]
chia/verification       time:   [6.8722 µs 6.9056 µs 6.9300 µs]
</code></pre><h2 class="relative group">Upcoming plans<div id=upcoming-plans class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#upcoming-plans aria-label=Anchor>#</a></span></h2><p>With that, I&rsquo;ll probably take a pause with GPU programming and wait for one of many issues/discussions I
opened/commented on in rust-gpu repository to be resolved, so that there isn&rsquo;t as much friction. Still, I think rust-gpu
has a future, I learned a lot about GPUs during the last week and looking forward to returning to this some time soon.
In fact, now that I can write shaders for GPUs, I think there are more protocol components that could be accelerated,
for example, plot auditing might be a good candidate for this.</p><p>Now I&rsquo;ll probably be going back to thinking and hopefully prototyping the state management nad Sparse Merkle Tree. I did
some research earlier, but didn&rsquo;t write anything specific in code yet.</p><p>Alfonso made some good progress on sharded consensus, so I might go back to that and make plotting/auditing/verification
shard-aware, though it&rsquo;d be nice to have a farmer and node in runnable shape first.</p><p>Basically as much work ahead as ever, but I&rsquo;m not hard to find on <a href=https://abundance.zulipchat.com/ target=_blank>Zulip</a> in case you have any thoughts about this
update or the whole project in general.</p></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_blog/2025-07-02-adventures-with-rust-gpu.md data-oid-likes=likes_blog/2025-07-02-adventures-with-rust-gpu.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/blog/2025-06-30-expiring-sharded-subspace-plots-and-improving-model-script/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Expiring Sharded Subspace Plots and improving model script</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-06-30T00:00:00+00:00>30 June 2025</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/blog/2025-07-07-simplifying-plot-expiration/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Simplifying Plot Expiration</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-07-07T00:00:00+00:00>7 July 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0 z-10"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400"><a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel="license noopener noreferrer">CC0 1.0 Universal</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer></div></body></html>