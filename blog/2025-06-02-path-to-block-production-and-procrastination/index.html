<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Path to block production and procrastination &#183; Project Abundance</title><meta name=title content="Path to block production and procrastination &#183; Project Abundance"><meta name=description content="Some work on refactoring for initial block production and some performance improvements"><meta name=keywords content="status-update,"><link rel=canonical href=https://abundance.build/blog/2025-06-02-path-to-block-production-and-procrastination/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fd951ea54edeca1b6b08c8bbf3c93c284de4c78daf63a71d8016939775734cf68700f1662ed31d870100c676cbe1f65d150635cf368b874c49fc75147bcb04a9.css integrity="sha512-/ZUepU7eyhtrCMi788k8KE3kx42vY6cdgBaTl3VzTPaHAPFmLtMdhwEAxnbL4fZdFQY1zzaLh0xJ/HUUe8sEqQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.e4b2d9aece2aa7a740c3ee7a0efc5acf56b204868ab0fb5bba9be32aed1cd0c9262979d98050759068d58144297f74b12ed05b5173cf2df2e6c097a066b984a8.js integrity="sha512-5LLZrs4qp6dAw+56Dvxaz1ayBIaKsPtbupvjKu0c0MkmKXnZgFB1kGjVgUQpf3SxLtBbUXPPLfLmwJegZrmEqA==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://abundance.build/blog/2025-06-02-path-to-block-production-and-procrastination/"><meta property="og:site_name" content="Project Abundance"><meta property="og:title" content="Path to block production and procrastination"><meta property="og:description" content="Some work on refactoring for initial block production and some performance improvements"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-06-02T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-02T00:00:00+00:00"><meta property="article:tag" content="status-update"><meta name=twitter:card content="summary"><meta name=twitter:title content="Path to block production and procrastination"><meta name=twitter:description content="Some work on refactoring for initial block production and some performance improvements"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"Path to block production and procrastination","headline":"Path to block production and procrastination","description":"Some work on refactoring for initial block production and some performance improvements","abstract":"\u003cp\u003eThere have not been an update from me last week, how come? Well, it didn\u0026rsquo;t seem like there was anything particularly\nsubstantial to share, mostly some refactoring, so I decided to skip it. This week though I have a few words to say about\nthe path towards block production (not there yet, but getting closer). Some this is a boring process, I procrastinated\nsome too, diving into various topics with some interesting performance improvements and new learnings.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/abundance.build\/blog\/2025-06-02-path-to-block-production-and-procrastination\/","author":{"@type":"Person","name":""},"copyrightYear":"2025","dateCreated":"2025-06-02T00:00:00\u002b00:00","datePublished":"2025-06-02T00:00:00\u002b00:00","dateModified":"2025-06-02T00:00:00\u002b00:00","keywords":["status-update"],"mainEntityOfPage":"true","wordCount":"1431"}]</script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Project Abundance</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Path to block production and procrastination</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-06-02T00:00:00+00:00>2 June 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/nazar-pc/abundance/tree/main/website/main/content/blog/2025-06-02-path-to-block-production-and-procrastination.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] mr-2" href=/tags/status-update/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">status-update</span></span></a></div></div><div class="flex author"><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex author author-extra mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/3d67cc976284fd62356e2edd8a8dfc49_2651210052118205119_hu_2fd6f6eca7f7083d.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://abundance.build/authors/nazar-pc/ class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Nazar Mokrynskyi</a><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/nazarpc target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/nazarpc target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/nazar-pc target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:nazar@mokrynskyi.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>There have not been an update from me last week, how come? Well, it didn&rsquo;t seem like there was anything particularly
substantial to share, mostly some refactoring, so I decided to skip it. This week though I have a few words to say about
the path towards block production (not there yet, but getting closer). Some this is a boring process, I procrastinated
some too, diving into various topics with some interesting performance improvements and new learnings.</p><h2 class="relative group">Sharding architecture<div id=sharding-architecture class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#sharding-architecture aria-label=Anchor>#</a></span></h2><h2 class="relative group">Block-related changes<div id=block-related-changes class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#block-related-changes aria-label=Anchor>#</a></span></h2><p>In the <a href=../2025-05-19-what-does-a-block-look-like/>previous update</a> I explained the way block is going to look like, but that was only parsing part of the binary
format, there was no owned data structures to move around, send over the network, etc. Owned version of data structures
landed in <a href=https://github.com/nazar-pc/abundance/pull/253 target=_blank>PR 253</a> with some follow-up changes in <a href=https://github.com/nazar-pc/abundance/pull/254 target=_blank>PR 254</a>. I then looked at reward singing and noticed we didn&rsquo;t
actually benefit from advanced features of Sr25519, so I migrated to Ed25519 to make it easier for third-parties to
build custom farmers and verify blocks, especially in other languages, in <a href=https://github.com/nazar-pc/abundance/pull/251 target=_blank>PR 251</a> and <a href=https://github.com/nazar-pc/abundance/pull/252 target=_blank>PR 252</a>. Funnily enough, we may
need to switch back depending on how we need to modify consensus implementation for sharding, but we&rsquo;ll see when we get
there.</p><h2 class="relative group">Refactoring of components and reducing Substrate dependencies<div id=refactoring-of-components-and-reducing-substrate-dependencies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#refactoring-of-components-and-reducing-substrate-dependencies aria-label=Anchor>#</a></span></h2><p>Now to build and verify blocks, proof of time is crucial, but they were still under <code>subspace</code> directory. I refactored
and moved <code>subspace-proof-of-{space,time}</code> into <code>crates/shared/ab-proof-of-{space,time}</code> in <a href=https://github.com/nazar-pc/abundance/pull/256 target=_blank>PR 256</a>. I even made PoT
verification a bit faster by removing heap allocations from it (both <code>alloc</code> and <code>std</code> features were removed).</p><p>Then I went on to refactor <code>sc-subspace-proof-of-time</code> to make it better suited for separation from Substate
dependencies in <a href=https://github.com/nazar-pc/abundance/pull/262 target=_blank>PR 262</a>, eventually extracting <code>crates/node/ab-client-proof-of-time</code>, which was very similar to
<code>sc-subspace-proof-of-time</code>, except thanks to refactored abstractions I was able to move just local timekeeper, leaving
block import and gossip handlers in <code>sc-subspace-proof-of-time</code> for now. This way I can continue work on block
production without implementing networking stack and having the whole block import pipeline working first. Local
timekeeper is all I need to get started, but the API is already in place to bring other components when they are ready.</p><p>With that done I moved on to massaging <code>sc-consensus-subspace</code> in <a href=https://github.com/nazar-pc/abundance/pull/265 target=_blank>PR 265</a>, whose slot worker was refactored to
integrate the minimal logic of <code>sc-consensus-slots</code> without relying on it anymore. This is a stepping stone for
disentangling it from Substrate completely. More work is needed, but that is basically where I am so far.</p><p>BTW the node and farmer implementations inherited from Substrate are still functional enough to produce blocks, etc. A
lot of original logic is gone by now of course, but at least I have something to sanity check my changes against.</p><h2 class="relative group">Performance improvements<div id=performance-improvements class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#performance-improvements aria-label=Anchor>#</a></span></h2><p>All that is often boring mechanical work or something that feels really vague and unbounded, which is
procrastination-inducing. What that means is that I&rsquo;m spending time reading about random things and doing experiments
that sometimes lead to unexpected performance improvements.</p><p>There are Proof-of-Time and Proof-of-Space components in the protocol design, which are performance sensitive.
Especially since sync and plotting performance will dictate parametrization and to some degree feasibility of sharding
design, they need to be as fast and efficient as possible.</p><h3 class="relative group">Proof-of-Time<div id=proof-of-time class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#proof-of-time aria-label=Anchor>#</a></span></h3><p>Since I was working around PoT a bit and already improved its verification performance by ~8-9% by avoiding heap
allocations, I recalled that <code>aes</code> crate still <a href=https://github.com/RustCrypto/block-ciphers/issues/372 target=_blank>doesn&rsquo;t support VAES</a>, so I decided to implement an optimized version
for PoT with <a href=https://en.wikipedia.org/wiki/AVX-512#VAES target=_blank>VAES</a> specifically myself in <a href=https://github.com/nazar-pc/abundance/pull/260 target=_blank>PR 260</a>. The results are awesome, on Zen 4 CPU (AVX512-capable) the time to
verify PoT reduced ~2x, taking overall 16x less time than proving and ~10x less time than the fastest CPUs out there can
prove:</p><pre tabindex=0><code>Before:
verify                  time:   [204.92 ms 205.10 ms 205.30 ms]

After:
verify                  time:   [102.38 ms 102.43 ms 102.53 ms]
</code></pre><p>Then I noticed something strange in CI when working on extending <code>no-panic</code> to <code>ab-proof-of-time</code> in <a href=https://github.com/nazar-pc/abundance/pull/264 target=_blank>PR 264</a> and later
enabling it on Windows in <a href=https://github.com/nazar-pc/abundance/pull/268 target=_blank>PR 268</a>, that I decided to not only implement it for AVX512-capable CPUs, but also for a few
of those that support VAES with AVX2 only (2 blocks at a time rather than 4) and even optimized version for many older
CPUs with just <a href=https://en.wikipedia.org/wiki/AES_instruction_set#x86_architecture_processors target=_blank>AES-NI</a> in <a href=https://github.com/nazar-pc/abundance/pull/269 target=_blank>PR 269</a>.</p><p>While in a mood, I ended up implementing optimized version for aarch64 as well in <a href=https://github.com/nazar-pc/abundance/pull/270 target=_blank>PR 270</a>, which on <a href=https://www.raspberrypi.com/products/raspberry-pi-5/ target=_blank>Raspberry PI 5</a>
SBC allowed to substantially improve performance (my guess is that Apple Silicon CPUs will improve as well, but I do not
own any):</p><pre tabindex=0><code>Before:
verify                  time:   [1.1665 s 1.1817 s 1.1976 s]

After:
verify                  time:   [835.30 ms 835.30 ms 835.31 ms]
</code></pre><h3 class="relative group">Proof-of-Space (Chia)<div id=proof-of-space-chia class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#proof-of-space-chia aria-label=Anchor>#</a></span></h3><p>Proof-of-Space was next. Over last 2 years I learned a lot about performance on modern CPUs and how to optimize
Proof-of-Space, but I was still repeatedly trying to improve its performance, often unsuccessfully. Last week though I
did make substantial progress again.</p><p>First there was <a href=https://github.com/nazar-pc/abundance/pull/266 target=_blank>PR 266</a>, where I managed to optimize code generation to make compiler vectorize more code for me by
structuring it a little differently. As a nice coincidence, the code became more readable too, which is not always the
case when optimizing for performance.</p><pre tabindex=0><code>Before:
chia/table/single       time:   [1.0668 s 1.0756 s 1.0862 s]
chia/table/parallel/8x  time:   [905.01 ms 919.11 ms 933.34 ms]
chia/verification       time:   [11.094 µs 11.533 µs 11.985 µs]

After:
chia/table/single       time:   [1.0245 s 1.0329 s 1.0432 s]
chia/table/parallel/8x  time:   [830.37 ms 843.37 ms 855.47 ms]
chia/verification       time:   [8.9454 µs 8.9612 µs 8.9726 µs]
</code></pre><p>I also was looking at GPU implementation more closely last few weeks and tempted to try to implement Proof-of-Space
table creation on GPU using <a href=https://github.com/tracel-ai/cubecl target=_blank>CubeCL</a>. Implementation in Subspace is designed for CUDA and ROCm, but it only supports GTX
16xx+/RTX 20xx+ GPUs on Nvidia side and on AMD side it is quite awkward to use, doesn&rsquo;t work on Windows with consumer
GPUs and requires separate binaries for Nvidia and AMD due to <a href=https://github.com/supranational/blst/pull/153 target=_blank>strange</a> <a href=https://github.com/supranational/blst/pull/203 target=_blank>design</a> <a href=https://github.com/supranational/sppark/commit/0a41eb5eea29975022166969d34550379615f271#r148977505 target=_blank>decisions</a> used in underlying
libraries. Not to mention that it doesn&rsquo;t work on AMD iGPUs, doesn&rsquo;t support GPUs from Intel or other vendors (like on
various ARM SBCs).</p><p>So going back to GPU implementation, I noticed it follows the Rust CPU implementation quite closely, even copied some
comments from it verbatim. The big unique thing was a custom GPU-optimized sorting implementation. Not only that, it
only sorted <code>Y</code> values, not the rest 🤔</p><p>Thinking about it some more, for the first Chia table we can indeed use stable sort and only consider <code>Y</code> because <code>X</code> is
already sorted originally and will remain in deterministic order if stable sort is used for <code>Y</code>. Now for the rest of the
tables it turns out a similar logic can be applied, but the buckets need to be processed in deterministic order, which
while not the case in Rust implementation right now, can be done and will open the possibility to sort by only <code>Y</code> as
well.</p><p>There is no PR with those changes, but I confirmed that substantial gains can be had from that change alone. Not only
that, GPU uses <a href=https://en.wikipedia.org/wiki/Radix_sort target=_blank>Radix sort</a>, which is really well suited for sorting integers. I read a bunch about that and looked at
few Rust implementations like <a href=https://github.com/lakwet/voracious_sort target=_blank>voracious_sort</a>, which bring further gains (though that particular library is actually
not <code>no_std</code>-compatible yet). But then while <a href=https://axelle.me/2020/11/21/voracious-sort/ target=_blank>reading about voracious sort on author&rsquo;s blog</a>, I learned that there is
even more niche sort that is even faster and fits the use case of sorting <code>Y</code> (which while are <code>u32</code> internally right
now, only store <code>K</code> bits of information in them, <code>K=20</code> right now in Subspace) called <a href=https://en.wikipedia.org/wiki/Counting_sort target=_blank>counting sort</a>, which is very
similar to Radix sort, but much simpler and has a single round!</p><p>Counting sort is something I&rsquo;m planning to use in Proof-of-Space, and it will work great or GPUs as well. Since the use
case is very narrow and specific, very simpler yet efficient implementation can be written and I have high hopes for it!
It&rsquo;ll also be a stepping stone for me in preparation for writing a GPU implementation.</p><p>BTW most of these changes are already backported to Subspace with more coming soon.</p><h2 class="relative group">Upcoming plans<div id=upcoming-plans class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#upcoming-plans aria-label=Anchor>#</a></span></h2><p>So that is what I&rsquo;ve been busy with last couple of weeks. Planning to continue working on block production in the near
future and will probably tackle that sorting replacement adventure, maybe even dabble into GPU programming (was
successful at avoiding it so far).</p><p>If you have any questions or thoughts, <a href=https://abundance.zulipchat.com/ target=_blank>Zulip</a> chat is currently the best place for reaching out. See you next week with
a fresh portion of updates.</p></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_blog/2025-06-02-path-to-block-production-and-procrastination.md data-oid-likes=likes_blog/2025-06-02-path-to-block-production-and-procrastination.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/blog/2025-05-26-longest-chain-rule-and-blocks-probability-of-reorganisation/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Longest-chain rule and blocks probability of reorganisation</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-05-26T00:00:00+00:00>26 May 2025</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/blog/2025-06-02-membership-selection-and-segment-verification/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Membership selection and segment verification</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-06-02T00:00:00+00:00>2 June 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0 z-10"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400"><a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel="license noopener noreferrer">CC0 1.0 Universal</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer></div></body></html>