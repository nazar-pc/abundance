<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Create an archiver task."><title>create_archiver_task in ab_client_archiving - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-b7b9f40b.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="ab_client_archiving" data-themes="" data-resource-suffix="" data-rustdoc-version="1.95.0-nightly (9e79395f9 2026-02-10)" data-channel="nightly" data-search-js="search-fb33671b.js" data-stringdex-js="stringdex-b897f86f.js" data-settings-js="settings-170eb4bf.js" ><script src="../static.files/storage-f9617a14.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-12f88f4f.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-f7c3ffd8.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc fn"><a class="skip-main-content" href="#main-content">Skip to main content</a><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">create_archiver_task</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../ab_client_archiving/index.html">ab_<wbr>client_<wbr>archiving</a><span class="version">0.0.1</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content" tabindex="-1"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="index.html">ab_client_archiving</a></div><h1>Function <span class="fn">create_<wbr>archiver_<wbr>task</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/ab_client_archiving/lib.rs.html#595-748">Source</a> </span></div><pre class="rust item-decl"><code>pub async fn create_archiver_task&lt;Block, CI&gt;(
    chain_info: CI,
    block_importing_notification_receiver: Receiver&lt;BlockImportingNotification&gt;,
    archived_segment_notification_sender: Sender&lt;<a class="struct" href="struct.ArchivedSegmentNotification.html" title="struct ab_client_archiving::ArchivedSegmentNotification">ArchivedSegmentNotification</a>&gt;,
    consensus_constants: ConsensusConstants,
    create_object_mappings: <a class="enum" href="enum.CreateObjectMappings.html" title="enum ab_client_archiving::CreateObjectMappings">CreateObjectMappings</a>,
    erasure_coding: ErasureCoding,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.ArchiverTaskError.html" title="enum ab_client_archiving::ArchiverTaskError">ArchiverTaskError</a>&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'static, <a class="enum" href="enum.ArchiverTaskError.html" title="enum ab_client_archiving::ArchiverTaskError">ArchiverTaskError</a>&gt;<div class="where">where
    Block: GenericOwnedBlock,
    CI: ChainInfoWrite&lt;Block&gt; + 'static,</div></code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Create an archiver task.</p>
<p>Archiver task will listen for importing blocks and archive blocks at <code>K</code> depth, producing pieces
and segment headers (segment headers are then added back to the blockchain in the next block).</p>
<p>NOTE: Archiver is doing blocking operations and must run in a dedicated task.</p>
<p>Archiver is only able to move forward and doesn’t support reorgs. Upon restart, it will check
segments in [<code>ChainInfo</code>] and chain history to reconstruct the “current” state it was in before
the last shutdown and continue incrementally archiving blockchain history from there.</p>
<p>Archiving is triggered by block importing notification (<code>block_importing_notification_receiver</code>)
and tries to archive the block at [<code>ConsensusConstants::confirmation_depth_k</code>] depth from the
block being imported. Block importing will then wait for archiver to acknowledge processing,
which is necessary for ensuring that when the next block is imported, the body will contain a
segment header of the newly archived segment.</p>
<p><code>create_object_mappings</code> controls when object mappings are created for archived blocks. When
these mappings are created.</p>
<p>Once a new segment is archived, a notification (<code>archived_segment_notification_sender</code>) will be
sent and archiver will be paused until all receivers have provided an acknowledgement for it.</p>
</div></details></section></div></main></body></html>